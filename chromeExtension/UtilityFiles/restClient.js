import {config} from './config';
import {SEALWrapper} from './fHE';

/**
 * @param {File} file
 * @return {json}
 */
async function requestScanFile(file) {
    let fHE = new SEALWrapper();
    const data = await file.slice().arrayBuffer();
    const encryptedData = await fHE.encrypt(data);
    const response = await fetch(config.hosturi + '/scan', {
        method: 'POST',
        body: JSON.stringify({ name: file.name, data: encryptedData.save() }, 
                (key, value) =>
                typeof value === 'bigint'
                    ? value.toString()
                    : value 
            ),
        headers: {
            'Content-Type': 'application/json'
        }
    });
    const resObj = await response.json();
    console.log(await fHE.decrypt(resObj.data))
    return resObj;
}

export {requestScanFile};