
if __name__ == "__main__":
        
    from app.app import generateApp
    import os
    from dotenv import load_dotenv
    import atexit
    from utility.cache import Cache, ResultTracker
    from utility.modelWrapper import ModelWrapper


    load_dotenv()

    flask_config = {
        'host' : os.environ.get('FLASK_HOST', '0.0.0.0'),
        'port' : int(os.environ.get('FLASK_PORT', 8000)),
        'debug' : os.environ.get('FLASK_DEBUG', 'True')
    }

    resultsTracker = ResultTracker()
    cache = Cache()
    model = ModelWrapper('ml.model')

    def clean_up_wrapper(toDel):
        def clean_up():
            del toDel
        return clean_up
    
    app = generateApp(resultsTracker, cache, model)

    #doesn't seem to have context
    #atexit.register(clean_up_wrapper(resultsTracker))
    app.run(**flask_config)