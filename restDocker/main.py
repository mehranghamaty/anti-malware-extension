
if __name__ == "__main__":

    from app.app import generateApp
    from utility.config import flask_config
    
    if not flask_config["debug"]: 
        import subprocess
        subprocess.run(["service", "clamav-daemon", "start"])
        subprocess.run(["service", "clamav-freshclam", "start"])
    
    print(flask_config)
    app = generateApp()

    #doesn't seem to have context
    #atexit.register(clean_up_wrapper(resultsTracker))
    if flask_config['debug']:
        app.run(**flask_config)
    else:
        #from waitress import serve
        #serve(app, host=flask_config["host"], port=flask_config["port"])
        from gevent.pywsgi import WSGIServer
        http_server = WSGIServer((flask_config["host"], flask_config["port"]), app)
        http_server.serve_forever()
