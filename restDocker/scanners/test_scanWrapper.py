
import flask_unittest

from scanners.scanWrapper import ScanWrapper
from utility.ScanMetaData import ScanMetaData
from app.appForTest import generateAppForTest

class TestScanWrapper(flask_unittest.AppClientTestCase):
    def create_app(self):
        self._scanner= ScanWrapper()
        return generateAppForTest(self._scanner)

    def testScanKnownBad(self, *_):
        test_file_path = "testFiles/GeForceNOW-release.exe"
        metadata = ScanMetaData(test_file_path)
        with open(test_file_path, 'rb') as file:
            bytes = file.read()
            res = self._scanner.scan(bytes, metadata)
            self.assertEqual(res, {'results': 'possibly_malicious', 'method': 'inhouse', 'reason' : 'Trojan'})
    
    def testPlainFile(self, *_):
        test_file_path = "testFiles/save.txt"
        metadata = ScanMetaData(test_file_path)
        with open(test_file_path, 'rb') as file:
            bytes = file.read()
            res = self._scanner.scan(bytes, metadata)
            self.assertEqual(res, {'results': 'clean', 'method': 'ClamAv'})

if __name__ == "__main__":
    TestScanWrapper.main()